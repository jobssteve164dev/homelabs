ã€2025-10-20 12:30ã€‘ä¿®æ­£Next.jsç¯å¢ƒå˜é‡åŠ è½½ç†è§£é”™è¯¯

é—®é¢˜è¯Šæ–­:
âœ… Next.jsåœ¨ç”Ÿäº§ç¯å¢ƒä¹Ÿä¼šè¯»å–.envæ–‡ä»¶ï¼ˆä¹‹å‰ç†è§£é”™è¯¯ï¼‰
âœ… .envæ–‡ä»¶é…ç½®æ­£ç¡®: PORT=3001
âœ… Nginxé…ç½®æ­£ç¡®: ä»£ç†åˆ°3001
âŒ Next.jså¯åŠ¨åœ¨3000ç«¯å£ï¼ˆé»˜è®¤ç«¯å£ï¼‰
âŒ ç¯å¢ƒé…ç½®æ–‡ä»¶æ£€æµ‹ä¸å­˜åœ¨

æ ¹æœ¬åŸå› :
PM2å¯åŠ¨npmè„šæœ¬æ—¶ï¼Œç¯å¢ƒå˜é‡ä¼ é€’å¯èƒ½ä¸å¯é 

ä¿®å¤æ–¹æ¡ˆ:
1. ä¿ç•™.envæ–‡ä»¶ï¼ˆè®©Next.jsæ ‡å‡†åŠ è½½ï¼‰
2. PM2å¯åŠ¨æ—¶æ˜¾å¼ä¼ é€’PORTå˜é‡
   PORT=3001 pm2 start npm -- start

åŒé‡ä¿éšœ:
âœ… .envæ–‡ä»¶: Next.jsæ ‡å‡†è¯»å–
âœ… PM2ç¯å¢ƒå˜é‡: æ˜¾å¼ä¼ é€’ç¡®ä¿ç”Ÿæ•ˆ

Commit: 1707cb9
ä¸‹ä¸€æ­¥: é‡æ–°éƒ¨ç½²éªŒè¯

---

szlk@szlk:/tmp$ ./troubleshooting_check.sh
==========================================
ğŸ” HOMELABS åº”ç”¨çŠ¶æ€æ£€æŸ¥
==========================================

1ï¸âƒ£  æ£€æŸ¥PM2è¿›ç¨‹çŠ¶æ€:
-----------------------------------
â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ id â”‚ name               â”‚ namespace   â”‚ version â”‚ mode    â”‚ pid      â”‚ uptime â”‚ â†º    â”‚ status    â”‚ cpu      â”‚ mem      â”‚ user     â”‚ watching â”‚
â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 0  â”‚ homelabs-portal    â”‚ default     â”‚ N/A     â”‚ fork    â”‚ 149868   â”‚ 69s    â”‚ 0    â”‚ online    â”‚ 0%       â”‚ 56.1mb   â”‚ szlk     â”‚ disabled â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[TAILING] Tailing last 30 lines for [homelabs-portal] process (change the value with --lines option)
/opt/homelabs/logs/pm2-error.log last 30 lines:
/home/szlk/.pm2/logs/homelabs-portal-out.log last 30 lines:
0|homelabs | 2025-10-20T04:24:34: 
0|homelabs | 2025-10-20T04:24:34: > homelabs-portal@1.0.0 start
0|homelabs | 2025-10-20T04:24:34: > next start
0|homelabs | 2025-10-20T04:24:34: 
0|homelabs | 2025-10-20T04:24:34:    â–² Next.js 15.5.5
0|homelabs | 2025-10-20T04:24:34:    - Local:        http://localhost:3000
0|homelabs | 2025-10-20T04:24:34:    - Network:      http://192.168.2.85:3000
0|homelabs | 2025-10-20T04:24:34: 
0|homelabs | 2025-10-20T04:24:34:  âœ“ Starting...
0|homelabs | 2025-10-20T04:24:34:  âœ“ Ready in 549ms


2ï¸âƒ£  æ£€æŸ¥ç«¯å£ç›‘å¬æƒ…å†µ:
-----------------------------------
åº”ç”¨ç«¯å£ 3001:
âš ï¸  ç«¯å£3001æœªç›‘å¬

Nginxç«¯å£ 3333:
LISTEN 0      511          0.0.0.0:3333      0.0.0.0:*    users:(("nginx",pid=148814,fd=15),("nginx",pid=148813,fd=15),("nginx",pid=140935,fd=15))
LISTEN 0      511             [::]:3333         [::]:*    users:(("nginx",pid=148814,fd=16),("nginx",pid=148813,fd=16),("nginx",pid=140935,fd=16))

3ï¸âƒ£  æ£€æŸ¥NginxçŠ¶æ€å’Œé…ç½®:
-----------------------------------
â— nginx.service - A high performance web server and a reverse proxy server
     Loaded: loaded (/lib/systemd/system/nginx.service; enabled; vendor preset: enabled)
     Active: active (running) since Mon 2025-10-20 03:30:09 UTC; 55min ago
       Docs: man:nginx(8)
   Main PID: 140935 (nginx)
      Tasks: 3 (limit: 2236)
     Memory: 5.5M
        CPU: 73ms
     CGroup: /system.slice/nginx.service
             â”œâ”€140935 "nginx: master process /usr/sbin/nginx -g daemon on; master_process on;"

Nginxé…ç½®æµ‹è¯•:
nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
nginx: configuration file /etc/nginx/nginx.conf test is successful

4ï¸âƒ£  æ£€æŸ¥Nginxé…ç½®å†…å®¹:
-----------------------------------
æ‰¾åˆ°Nginxé…ç½®æ–‡ä»¶:
        proxy_pass http://localhost:3001;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
--
        proxy_pass http://localhost:3001;
        expires 1y;
        add_header Cache-Control "public, immutable";
    }

    location ~* \.(jpg|jpeg|png|gif|ico|svg|webp)$ {
        proxy_pass http://localhost:3001;
        expires 30d;
        add_header Cache-Control "public, immutable";
    }

    # æ—¥å¿—é…ç½®

5ï¸âƒ£  æµ‹è¯•æœ¬åœ°è®¿é—®:
-----------------------------------
æµ‹è¯•åº”ç”¨ç«¯å£ 3001:
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0
curl: (7) Failed to connect to localhost port 3001 after 0 ms: Connection refused

æµ‹è¯•Nginxç«¯å£ 3333:
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0   166    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0
HTTP/1.1 502 Bad Gateway
Server: nginx/1.18.0 (Ubuntu)
Date: Mon, 20 Oct 2025 04:25:43 GMT
Content-Type: text/html
Content-Length: 166
Connection: keep-alive


6ï¸âƒ£  æ£€æŸ¥åº”ç”¨æ—¥å¿— (æœ€è¿‘30è¡Œ):
-----------------------------------
=== PM2æ—¥å¿— ===

=== åº”ç”¨é”™è¯¯æ—¥å¿— ===

=== æœ€è¿‘çš„ç»¼åˆæ—¥å¿— ===

7ï¸âƒ£  æ£€æŸ¥ç¯å¢ƒå˜é‡é…ç½®:
-----------------------------------
âš ï¸  ç¯å¢ƒé…ç½®æ–‡ä»¶ä¸å­˜åœ¨

8ï¸âƒ£  æ£€æŸ¥PostgreSQLæ•°æ®åº“è¿æ¥:
-----------------------------------
     datname     
-----------------
 homelabs_portal
(1 row)


9ï¸âƒ£  æ£€æŸ¥è¿›ç¨‹è¯¦æƒ…:
-----------------------------------
szlk      149897  0.0  0.0   2892   972 ?        S    04:24   0:00 sh -c next start
szlk      149898  1.5  8.6 13359972 175548 ?     Sl   04:24   0:01 next-server (v15.5.5)

==========================================
âœ… æ£€æŸ¥å®Œæˆ
==========================================

ğŸ’¡ å¿«é€Ÿä¿®å¤å»ºè®®:
  - å¦‚æœPM2æ˜¾ç¤ºstopped: pm2 restart homelabs-portal
  - å¦‚æœç«¯å£æœªç›‘å¬: æ£€æŸ¥åº”ç”¨æ—¥å¿—ä¸­çš„é”™è¯¯
  - å¦‚æœNginxæœªè¿è¡Œ: sudo systemctl start nginx
  - æŸ¥çœ‹å®æ—¶æ—¥å¿—: pm2 logs homelabs-portal