# HOMELABS Portal Docker All-in-One ÈÉ®ÁΩ≤ÊñáÊ°£

## üìã Ê¶ÇËø∞

Êú¨ÊñáÊ°£‰ªãÁªçÂ¶Ç‰Ωï‰ΩøÁî® **Docker All-in-One Ê®°Âºè** ÈÉ®ÁΩ≤ HOMELABS Portal„ÄÇ

### All-in-One Ê®°ÂºèÁâπÁÇπ

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ           Âçï‰∏Ä Docker ÂÆπÂô®              ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ         Next.js Â∫îÁî®            ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ         (Port 3000)             ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îÇ                  ‚îÇ localhost           ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ         PostgreSQL              ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ         (ÂÜÖÈÉ® 5432)             ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îÇ                                         ‚îÇ
‚îÇ  üìÅ /app/logs/                          ‚îÇ
‚îÇ     ‚îú‚îÄ‚îÄ postgresql/                     ‚îÇ
‚îÇ     ‚îú‚îÄ‚îÄ app/                            ‚îÇ
‚îÇ     ‚îî‚îÄ‚îÄ combined.log                    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**‰ºòÁÇπÔºö**
- ‚úÖ ÊúÄÁÆÄÈÖçÁΩÆÔºåÂè™ÈúÄ 1 ‰∏™ÂÆπÂô®
- ‚úÖ Êï∞ÊçÆÂ∫ì‰ΩøÁî® localhost ËøûÊé•ÔºåÊó†ÁΩëÁªúÈóÆÈ¢ò
- ‚úÖ Êó†ÈúÄÈÖçÁΩÆ Redis„ÄÅNginx
- ‚úÖ Áªü‰∏ÄÊó•ÂøóÁÆ°ÁêÜ

---

## üöÄ Âø´ÈÄüÂºÄÂßãÔºàÊúÄÂ∞èÈÖçÁΩÆÔºâ

### ÂøÖÈúÄÁöÑ SecretsÔºà3 ‰∏™Ôºâ

| Secret ÂêçÁß∞ | ËØ¥Êòé | Á§∫‰æã |
|------------|------|------|
| `SERVER_SSH_KEY` | ÊúçÂä°Âô® SSH ÁßÅÈí• | `-----BEGIN OPENSSH PRIVATE KEY-----...` |
| `POSTGRES_PASSWORD` | Êï∞ÊçÆÂ∫ìÂØÜÁ†Å | `your_strong_password` |
| `NEXTAUTH_SECRET` | ËÆ§ËØÅÂØÜÈí•Ôºà32+ Â≠óÁ¨¶Ôºâ | `openssl rand -base64 32` |

### ÂøÖÈúÄÁöÑ VariablesÔºà3 ‰∏™Ôºâ

| Variable ÂêçÁß∞ | ËØ¥Êòé | Á§∫‰æã |
|--------------|------|------|
| `SERVER_HOST` | ÊúçÂä°Âô® IP ÊàñÂüüÂêç | `192.168.1.100` |
| `SSH_USER` | SSH ÁôªÂΩïÁî®Êà∑ | `ubuntu` |
| `NEXTAUTH_URL` | Â∫îÁî®ËÆøÈóÆÂú∞ÂùÄ | `http://192.168.1.100:3000` |

> ‚ö†Ô∏è **Ê≥®ÊÑè**: All-in-One Ê®°ÂºèÈªòËÆ§‰∏ç‰ΩøÁî® NginxÔºåÈúÄË¶ÅÂú® `NEXTAUTH_URL` ‰∏≠ÂåÖÂê´Á´ØÂè£Âè∑ÔºÅ

### Ëß¶ÂèëÈÉ®ÁΩ≤

‰øÆÊîπ `changelog.md` Âπ∂Êé®ÈÄÅÔºåÊàñÊâãÂä®Ëß¶Âèë GitHub Actions„ÄÇ

---

## üì¶ ÂÆåÊï¥ÂèòÈáèÈÖçÁΩÆ

### ÈÉ®ÁΩ≤Êû∂ÊûÑÊéßÂà∂ÔºàAll-in-One ‰∏ìÁî®Ôºâ

| Variable ÂêçÁß∞ | ËØ¥Êòé | ÈªòËÆ§ÂÄº |
|--------------|------|--------|
| `DEPLOY_ARCHITECTURE` | ÈÉ®ÁΩ≤Êû∂ÊûÑ | `all-in-one` |
| `USE_NGINX` | ÊòØÂê¶ÂêØÁî® Nginx ÂèçÂêë‰ª£ÁêÜ | `false` |

### Ê†∏ÂøÉÈÖçÁΩÆ

| Á±ªÂûã | ÂêçÁß∞ | ËØ¥Êòé | ÈªòËÆ§ÂÄº |
|------|------|------|--------|
| **Secret** | `POSTGRES_PASSWORD` | Êï∞ÊçÆÂ∫ìÂØÜÁ†Å | ‚ö†Ô∏è ÂøÖÂ°´ |
| **Secret** | `NEXTAUTH_SECRET` | ËÆ§ËØÅÂØÜÈí• | ‚ö†Ô∏è ÂøÖÂ°´ |
| **Variable** | `POSTGRES_DB` | Êï∞ÊçÆÂ∫ìÂêçÁß∞ | `homelabs_portal` |
| **Variable** | `POSTGRES_USER` | Êï∞ÊçÆÂ∫ìÁî®Êà∑ | `homelabs` |
| **Variable** | `APP_PORT` | Â∫îÁî®Á´ØÂè£ | `3000` |
| **Variable** | `LOG_LEVEL` | Êó•ÂøóÁ∫ßÂà´ | `info` |

### ÊúçÂä°Âô®ÈÖçÁΩÆ

| Á±ªÂûã | ÂêçÁß∞ | ËØ¥Êòé | ÈªòËÆ§ÂÄº |
|------|------|------|--------|
| **Secret** | `SERVER_SSH_KEY` | SSH ÁßÅÈí• | ‚ö†Ô∏è ÂøÖÂ°´ |
| **Variable** | `SERVER_HOST` | ÊúçÂä°Âô®Âú∞ÂùÄ | ‚ö†Ô∏è ÂøÖÂ°´ |
| **Variable** | `SSH_USER` | SSH Áî®Êà∑ | ‚ö†Ô∏è ÂøÖÂ°´ |
| **Variable** | `SSH_PORT` | SSH Á´ØÂè£ | `22` |
| **Variable** | `DEPLOY_PATH` | ÈÉ®ÁΩ≤ÁõÆÂΩï | `/opt/homelabs` |

### Nginx Áõ∏ÂÖ≥Ôºà‰ªÖÂΩì `USE_NGINX=true`Ôºâ

| Á±ªÂûã | ÂêçÁß∞ | ËØ¥Êòé | ÈªòËÆ§ÂÄº |
|------|------|------|--------|
| **Variable** | `NGINX_PORT` | Nginx HTTP Á´ØÂè£ | `80` |
| **Variable** | `NGINX_SSL_PORT` | Nginx HTTPS Á´ØÂè£ | `443` |
| **Variable** | `PRIMARY_DOMAIN` | ‰∏ªÂüüÂêç | `localhost` |
| **Variable** | `USE_SSL` | ÂêØÁî® HTTPS | `false` |
| **Secret** | `SSL_EMAIL` | Let's Encrypt ÈÇÆÁÆ± | - |

---

## üéØ ÈÖçÁΩÆÁ§∫‰æã

### Á§∫‰æã 1: ÊúÄÁÆÄÁßÅÂüüÈÉ®ÁΩ≤ÔºàÊé®ËçêÔºâ

```
# Secrets
SERVER_SSH_KEY = [‰Ω†ÁöÑ SSH ÁßÅÈí•]
POSTGRES_PASSWORD = MySecurePassword123
NEXTAUTH_SECRET = [openssl rand -base64 32 ÁöÑËæìÂá∫]

# Variables
SERVER_HOST = 192.168.1.100
SSH_USER = ubuntu
NEXTAUTH_URL = http://192.168.1.100:3000
```

ËÆøÈóÆÂú∞ÂùÄ: `http://192.168.1.100:3000`

### Á§∫‰æã 2: ÂêØÁî® NginxÔºàÈúÄË¶Å 80 Á´ØÂè£Ôºâ

```
# È¢ùÂ§ñÊ∑ªÂä†ÁöÑ Variables
USE_NGINX = true
NGINX_PORT = 80
NEXTAUTH_URL = http://192.168.1.100  # ‰∏çÈúÄË¶ÅÁ´ØÂè£Âè∑
```

ËÆøÈóÆÂú∞ÂùÄ: `http://192.168.1.100`

### Á§∫‰æã 3: Áîü‰∫ßÁéØÂ¢É + HTTPS

```
# Variables
DEPLOY_ENVIRONMENT = production
USE_NGINX = true
USE_SSL = true
PRIMARY_DOMAIN = portal.example.com
NEXTAUTH_URL = https://portal.example.com

# Secrets
SSL_EMAIL = admin@example.com
```

ËÆøÈóÆÂú∞ÂùÄ: `https://portal.example.com`

---

## üìä All-in-One vs Multi-Container ÂØπÊØî

| ÁâπÊÄß | All-in-One | Multi-Container |
|------|-----------|-----------------|
| ÂÆπÂô®Êï∞Èáè | 1-2 ‰∏™ | 4 ‰∏™ |
| Êï∞ÊçÆÂ∫ìËøûÊé• | localhost | Docker ÁΩëÁªú |
| ÈÖçÁΩÆÂ§çÊùÇÂ∫¶ | ‰Ωé | È´ò |
| ËµÑÊ∫êÂç†Áî® | ‰Ωé | ‰∏≠ |
| Redis | ‰∏çÈúÄË¶Å | ÈúÄË¶Å |
| ÈÄÇÁî®Âú∫ÊôØ | ÁßÅÂüü/Â∞èÂûã | Â§ßËßÑÊ®°/ÈúÄÊâ©Â±ï |

### ‰∏çÂÜçÈúÄË¶ÅÁöÑÂèòÈáèÔºàÂØπÊØî Multi-ContainerÔºâ

‰ª•‰∏ãÂèòÈáèÂú® All-in-One Ê®°Âºè‰∏ã**‰∏çÈúÄË¶ÅÈÖçÁΩÆ**Ôºö

| Variable | ÂéüÂõ† |
|----------|------|
| `POSTGRES_HOST_PORT` | Êï∞ÊçÆÂ∫ìÂÜÖÂµåÔºå‰∏çÊö¥Èú≤Á´ØÂè£ |
| `REDIS_HOST_PORT` | ‰∏ç‰ΩøÁî® Redis |
| `REDIS_URL` | ÈÄüÁéáÈôêÂà∂‰ΩøÁî®ÂÜÖÂ≠òÊ®°Âºè |

---

## üîß ÈÉ®ÁΩ≤ÂêéÈ™åËØÅ

### Ê£ÄÊü•ÂÆπÂô®Áä∂ÊÄÅ

```bash
cd /opt/homelabs
docker compose ps
```

È¢ÑÊúüËæìÂá∫ÔºàUSE_NGINX=falseÔºâÔºö
```
NAME            STATUS    PORTS
homelabs-app    Up        0.0.0.0:3000->3000/tcp
```

È¢ÑÊúüËæìÂá∫ÔºàUSE_NGINX=trueÔºâÔºö
```
NAME             STATUS    PORTS
homelabs-app     Up        3000/tcp
homelabs-nginx   Up        0.0.0.0:80->80/tcp
```

### Êü•ÁúãÊó•Âøó

```bash
# ÂÆûÊó∂ÂÆπÂô®ËæìÂá∫
docker compose logs -f app

# ÁªÑÂêàÊó•ÂøóÔºàPostgreSQL + AppÔºâ
docker compose exec app tail -f /app/logs/combined.log

# PostgreSQL Êó•Âøó
docker compose exec app tail -f /app/logs/postgresql/postgresql-$(date +%Y-%m-%d).log

# Â∫îÁî®Êó•Âøó
docker compose exec app tail -f /app/logs/app/app-$(date +%Y-%m-%d).log
```

### Ê£ÄÊü•Êï∞ÊçÆÂ∫ì

```bash
# ËøõÂÖ•ÂÆπÂô®ÊâßË°å psql
docker compose exec app su-exec postgres psql -d homelabs_portal -c "\dt"
```

---

## ‚ùì Â∏∏ËßÅÈóÆÈ¢ò

### Q1: ‰∏∫‰ªÄ‰πà NEXTAUTH_URL ÈúÄË¶ÅÂåÖÂê´Á´ØÂè£Âè∑Ôºü

**A**: Âõ†‰∏∫ÈªòËÆ§ `USE_NGINX=false`ÔºåÂ∫îÁî®Áõ¥Êé•Êö¥Èú≤Âú® `APP_PORT`ÔºàÈªòËÆ§ 3000Ôºâ„ÄÇÂ¶ÇÊûú‰Ω†ÂêØÁî®‰∫Ü NginxÔºåÂàô‰ΩøÁî® Nginx Á´ØÂè£ÔºàÈªòËÆ§ 80ÔºâÔºå‰∏çÈúÄË¶ÅÁ´ØÂè£Âè∑„ÄÇ

### Q2: Êï∞ÊçÆÂ∫ìËøûÊé•Â§±Ë¥•ÊÄé‰πàÂäûÔºü

**A**: All-in-One Ê®°Âºè‰∏ãÊï∞ÊçÆÂ∫ì‰ΩøÁî® localhostÔºå‰∏ç‰ºöÊúâÁΩëÁªúÈóÆÈ¢ò„ÄÇÊ£ÄÊü•Êó•ÂøóÔºö
```bash
docker compose exec app tail -50 /app/logs/combined.log | grep -i postgres
```

### Q3: Â¶Ç‰ΩïÂ§á‰ªΩÊï∞ÊçÆÂ∫ìÔºü

**A**:
```bash
# Â§á‰ªΩ
docker compose exec app su-exec postgres pg_dump homelabs_portal > backup.sql

# ÊÅ¢Â§ç
docker compose exec -T app su-exec postgres psql homelabs_portal < backup.sql
```

### Q4: Â¶Ç‰ΩïÊü•Áúã PostgreSQL ÊÖ¢Êü•ËØ¢Ôºü

**A**: PostgreSQL Â∑≤ÈÖçÁΩÆËÆ∞ÂΩïË∂ÖËøá 1 ÁßíÁöÑÊü•ËØ¢Ôºö
```bash
docker compose exec app grep "duration:" /app/logs/postgresql/postgresql-$(date +%Y-%m-%d).log
```

---

## üìö Áõ∏ÂÖ≥ÊñáÊ°£

- [Variables vs Secrets ÂÆåÊï¥ÊåáÂçó](./VARIABLES_VS_SECRETS.md)
- [Èùû Docker ÈÉ®ÁΩ≤ÊñáÊ°£](./DEPLOYMENT.md)
- [Docker ÊïÖÈöúÊéíÈô§](./DOCKER_DEPLOYMENT_TROUBLESHOOTING.md)

---

**ÊúÄÂêéÊõ¥Êñ∞**: 2025-11-27
**Áª¥Êä§ËÄÖ**: AI Assistant

